"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(u,p,l){if(!u.fetch)throw new ClientError(400,"Fetch API Not Supported");p.gEBI=p.getElementById,p.cE=p.createElement,u.IntersectionObserver&&u.IntersectionObserverEntry&&"intersectionRatio"in u.IntersectionObserverEntry.prototype?"isIntersecting"in u.IntersectionObserverEntry.prototype||Object.defineProperty(u.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return 0<this.intersectionRatio}}):r("js/intersection-observer.js");var ClientError=function ClientError(e,t){_classCallCheck(this,ClientError),this.code=e,this.message=t},f=void 0,h=void 0,c=!1;function n(t){"loading"!==p.readyState?t():p.addEventListener("DOMContentLoaded",function e(){t(),p.removeEventListener("DOMContentLoaded",e)})}function o(o,s,c){if(u.indexedDB){var e=u.indexedDB.open("nyc_rr_data",1);return e.onupgradeneeded=function(e){var t=e.target.result;t.createObjectStore(o,{keyPath:"id"}),"restaurants"===o&&t.createObjectStore("reviews",{keyPath:"id"}).createIndex("restaurant_id","restaurant_id",{unique:!1})},new Promise(function(n){e.onsuccess=function(e){var a=e.target.result,t=a.transaction([o],"readonly").objectStore(o),i="reviews"===o?t.index("restaurant_id"):t;n(new Promise(function(n){var r=[],e=c?IDBKeyRange.only(c):null;i.openCursor(e).onsuccess=function(e){var t=e.target.result;t||r.length?t?(r.push(t.value),t.continue()):n(r):n(fetch(s).then(function(e){if(!e.ok)throw Error("Request failed. Returned status of "+e.statusText);return e.json()}).then(function(e){var t=a.transaction([o],"readwrite").objectStore(o);return e.forEach(function(e){t.add(e)}),e}).catch(function(e){console.log(e)}))},i.openCursor(e).onerror=function(e){console.log(e.target.error),n(d(o,s))}}))},e.onerror=function(e){console.log(e.target.error),n(d(o,s))}})}return d(o,s)}function d(e,t){return fetch(t).then(function(e){if(!e.ok)throw Error("Request failed. Returned status of "+e.statusText);return e.json()}).then(function(e){return e}).catch(function(e){console.log(e)})}function v(e,t){return new google.maps.Marker({position:e.latlng,title:e.name+" "+e.neighborhood,url:m(e),map:t,animation:google.maps.Animation.DROP})}function m(e){return"/restaurant.html?id="+e.id}function s(e,t){return"/img/"+e.photograph+"-"+t+"w.jpg"}function r(e){var t=p.cE("script");t.src=e,t.setAttribute("async",""),p.head.appendChild(t)}function g(e){var t=setTimeout(e);u.addEventListener("resize",function(){clearTimeout(t),t=setTimeout(e,60)})}function E(){var e=f.clientWidth,t=f.clientHeight,n=640<e||640<t?2:1,r=t<e?+(e/t).toFixed(6):+(t/e).toFixed(6);return t<e?(e=640<e?640:e,t=Math.round(e/r)):(t=640<t?640:t,e=Math.round(t/r)),{width:e,height:t,scale:n}}function y(){f.style.cursor="pointer",i(f,function(e){var t;l.onLine?(r("https://maps.googleapis.com/maps/api/js?key=AIzaSyAxfOOcB40yMKfupF4qyfa4hwvhTclZboA&libraries=places&callback=initMap"),t=e,p.gEBI("map").style.display="block",f.removeAttribute("tabindex"),f.removeAttribute("role"),f.removeAttribute("aria-label"),t&&setTimeout(function(){p.querySelector('#map div[tabindex="0"]').focus()},1e3)):b("x")},!0)}function i(n,r,a){var i=function(e,t){e.preventDefault(),e.stopPropagation(),r(t),a&&(n.removeEventListener("click",i),n.removeEventListener("keydown",o))},o=function(e){13===e.keyCode&&i(e,!0)};n.addEventListener("click",i),n.addEventListener("keydown",o)}function b(e){var t=p.cE("div"),n=p.cE("p");if(t.id="offline-alert",t.setAttribute("role","alert"),n.innerHTML="âš  You are offline, map is not available.",t.appendChild(n),e){var r=p.cE("p"),a=p.cE("button");a.type="button",a.innerHTML="CLOSE",r.appendChild(a),t.appendChild(r),i(a,function(){t.remove(),f.removeAttribute("class"),y()})}f.className="offline",f.appendChild(t),f.style.cursor="default"}function w(e){e.addListener("click",function(){u.location.href=e.url})}function L(i,o){var e=new google.maps.OverlayView;if(e.draw=function(){this.getPanes().markerLayer.id="markerLayer"},e.setMap(h),c)i();else var s=h.addListener("tilesloaded",function(){var e,t,n,r,a;i(),e=o,t=p.cE("a"),n=p.cE("h2"),r=p.querySelector('#map div[tabindex="0"]'),a=p.gEBI("map"),t.className="skip-link button",t.href=e?"#filter-options":"#restaurant-container",t.innerHTML="Skip the map",f.insertBefore(t,f.firstChild),n.id="map-label",n.className="sr-only",n.innerHTML="Google Maps Widget: shows restaurants location",f.insertBefore(n,f.firstChild),r.setAttribute("aria-labelledby","map-label"),r.addEventListener("focus",function(){a.classList.add("focused")}),r.addEventListener("blur",function(){a.classList.remove("focused")}),a.addEventListener("focus",function(){h.setOptions({keyboardShortcuts:!0})},!0),a.addEventListener("blur",function(){h.setOptions({keyboardShortcuts:!1})},!0),c=!0,google.maps.event.removeListener(s)})}function M(a,i,o){setTimeout(function(){for(var e=p.querySelectorAll('[id^="gmimap"]> area'),n=p.querySelectorAll("#markerLayer img"),t=function(t){e[t].tabIndex=0,e[t].addEventListener("focus",function(){n[t].classList.add("focused")}),e[t].addEventListener("blur",function(){n[t].classList.remove("focused")}),e[t].addEventListener("keydown",function(e){13===e.keyCode&&(a=a||i[t],u.location.href=m(a))})},r=0;r<e.length;r++)t(r);o()},150)}function C(e,t,n){var r=p.cE("img");if(r.className="restaurant-img",r.alt=e.photoDescription||(n?"The "+e.cuisine_type+" Restaurant "+e.name:"The Restaurant "+e.name+" in "+e.neighborhood),r.src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="8" height="6"></svg>',e.photograph){var a=p.cE("picture"),i=p.cE("source"),o=p.cE("source");i.dataset.srcset=function(e){for(var t=[],n=3;n<9;n++)t.push(s(e,100*n)+" "+100*n+"w");return t.join(", ")}(e),o.dataset.srcset=i.dataset.srcset.replace(/w.jpg/g,"w.webp"),i.sizes="(min-width: 1366px) calc((1366px - "+(n?"5rem) / 4":"4rem) / 3")+"), (min-width: 1080px) calc((100vw - 4rem) / 3), (min-width: 700px) calc((100vw - 3rem) / 2), calc(100vw - 2rem)",o.sizes=i.sizes,r.dataset.src=s(e,800),r.classList.add("lazy"),r.onerror=function(){o.remove()},a.append(o,i,r),t.insertBefore(a,t.firstChild)}else r.src="/img/image-fallback.svg",t.insertBefore(r,t.firstChild)}function I(){var e=[].slice.call(p.querySelectorAll(".lazy"));if(e){var a=new IntersectionObserver(function(e){e.forEach(function(e){if(e.isIntersecting){var t=e.target,n=t.parentElement.children[0],r=t.parentElement.children[1];n.srcset=n.dataset.srcset,r.srcset=r.dataset.srcset,t.src=t.dataset.src,t.style.opacity=1,n.removeAttribute("data-srcset"),r.removeAttribute("data-srcset"),t.removeAttribute("data-src"),a.unobserve(t)}})});e.forEach(function(e){a.observe(e)})}}o("restaurants","http://localhost:1337/restaurants").then(function(c){"/"===u.location.pathname||"/index.html"===u.location.pathname?function(){var r=[],a=void 0,i=void 0,d=void 0;function e(){return new Promise(function(e){var t=a[a.selectedIndex].value,n=i[i.selectedIndex].value,r=c.slice(0);"all"!=n&&(r=r.filter(function(e){return e.cuisine_type===n})),"all"!=t&&(r=r.filter(function(e){return e.neighborhood===t})),e(r)})}function o(t){t.forEach(function(e){var t=v(e,h);w(t),r.push(t)}),L(function(){M(null,t,function(){var e=1<t.length?"s":"";p.querySelector("#map iframe").title="Map shows "+t.length+" restaurant"+e})},!0)}function t(){e().then(function(e){var t,n;h&&(t=e,r.length&&(r.forEach(function(e){return e.setMap(null)}),r=[]),o(t)),n=e,d.innerHTML="",s(n),I()})}function s(e){var t=p.gEBI("results-notice");if(e.length){e.forEach(function(e){var t,n,r,a,i,o,s,c,u,l;d.appendChild((t=e,n=p.cE("li"),r=p.cE("article"),a=p.cE("h3"),i=p.cE("p"),o=p.cE("strong"),s=p.cE("address"),c=p.cE("p"),u=p.cE("p"),l=p.cE("a"),C(t,r,!0),a.innerHTML=t.name,o.innerHTML=""+t.neighborhood,i.appendChild(o),c.innerHTML=t.address,s.appendChild(c),l.innerHTML="View Details",l.href=m(t),l.className="button",l.setAttribute("aria-label","View Details about "+t.name),u.appendChild(l),r.append(a,i,s,u),n.appendChild(r),n))});var n=1<e.length?"s":"";t.innerHTML=e.length+" restaurant"+n+" found"}else t.innerHTML="No restaurants found"}n(function(){f=p.gEBI("static-map"),a=p.gEBI("neighborhoods-select"),i=p.gEBI("cuisines-select"),d=p.gEBI("restaurants-list"),l.onLine?(g(function(){var e;e=E(),f.style.backgroundImage="url(https://maps.googleapis.com/maps/api/staticmap?center=40.722216,-73.987501&zoom=12&size="+e.width+"x"+e.height+"&scale="+e.scale+"&format=jpg&key=AIzaSyAxfOOcB40yMKfupF4qyfa4hwvhTclZboA)"}),y()):b(),function(){a.addEventListener("change",t),i.addEventListener("change",t);var n=c.map(function(e,t){return c[t].neighborhood});(n=n.filter(function(e,t){return n.indexOf(e)===t})).forEach(function(e){var t=p.cE("option");t.innerHTML=e,t.value=e,a.appendChild(t)});var r=c.map(function(e,t){return c[t].cuisine_type});(r=r.filter(function(e,t){return r.indexOf(e)===t})).forEach(function(e){var t=p.cE("option");t.innerHTML=e,t.value=e,i.appendChild(t)})}(),s(c),I()}),u.initMap=function(){h=new google.maps.Map(p.gEBI("map"),{center:{lat:40.722216,lng:-73.987501},zoom:12,scrollwheel:!1,keyboardShortcuts:!1}),e().then(function(e){o(e)})}}():function(){var i=function(){var e=new URL(u.location.href).searchParams.get("id");if(e&&c[e-1])return c[e-1]}();if(!i)throw new ClientError(404,"File Not Found");n(function(){var e,t,n,r,a;f=p.gEBI("static-map"),l.onLine?(g(function(){var e;e=E(),f.style.backgroundImage="url(https://maps.googleapis.com/maps/api/staticmap?size="+e.width+"x"+e.height+"&scale="+e.scale+"&markers=color:red%7C"+i.latlng.lat+","+i.latlng.lng+"&format=jpg&key=AIzaSyAxfOOcB40yMKfupF4qyfa4hwvhTclZboA)"}),y()):b(),e=i,t=p.gEBI("breadcrumb"),n=p.cE("li"),r=p.cE("a"),a=m(e),r.href=a,r.setAttribute("aria-current","page"),r.innerHTML=e.name,n.appendChild(r),t.appendChild(n),function(e){var t=p.querySelector("#restaurant-container> div"),n=p.gEBI("restaurant-name"),r=p.gEBI("restaurant-address"),a=p.gEBI("restaurant-cuisine"),i=p.cE("strong");p.title=e.name+" - Restaurant Info and Reviews",C(e,t),n.innerHTML=e.name,r.innerHTML=e.address,i.innerHTML="Type of Cuisine: "+e.cuisine_type,a.appendChild(i),e.operating_hours&&function(e){var t=p.gEBI("restaurant-hours");for(var n in e){var r=p.cE("tr"),a=p.cE("th"),i=p.cE("td");a.innerHTML=n,a.scope="row",i.innerHTML=e[n],r.append(a,i),t.appendChild(r)}}(e.operating_hours);o("reviews","http://localhost:1337/reviews/?restaurant_id="+e.id,e.id).then(function(e){!function(e){var t=p.gEBI("reviews-container"),n=p.cE("h2"),f=p.gEBI("reviews-list");if(n.innerHTML="Reviews",t.appendChild(n),!e){var r=p.cE("p");return r.innerHTML=l.online?"No reviews yet!":"Sorry, reviews for this restaurant are not available offline.",t.appendChild(r)}e.forEach(function(e){var t,n,r,a,i,o,s,c,u,l,d;f.appendChild((t=e,n=p.cE("li"),r=p.cE("article"),a=p.cE("header"),i=p.cE("h3"),o=p.cE("span"),s=p.cE("time"),c=p.cE("p"),u=p.cE("abbr"),l=p.cE("p"),d=new Date(t.updatedAt),o.innerHTML=t.name,s.dateTime=d.toISOString(),s.innerHTML=d.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),i.append(o,s),a.appendChild(i),u.title="Rating: "+t.rating+" of 5",u.className="stars-"+t.rating,c.appendChild(u),l.innerHTML=t.comments,r.append(a,c,l),n.appendChild(r),n))}),t.appendChild(f)}(e)}).catch(function(e){console.log(e)})}(i),I()}),u.initMap=function(){h=new google.maps.Map(p.gEBI("map"),{center:i.latlng,zoom:17,scrollwheel:!1,keyboardShortcuts:!1}),w(v(i,h)),L(function(){M(i,null,function(){p.querySelector("#map iframe").title="Map shows "+i.name+" location"})})}}()}).catch(function(e){console.log(e)})}(window,document,navigator);
//# sourceMappingURL=app.js.map
