"use strict";var _createClass=function(){function r(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,n,e){return n&&r(t.prototype,n),e&&r(t,e),t}}();function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"fetchRestaurants",value:function(){if(window.indexedDB){var t=window.indexedDB.open("nyc_rr_data",1);return t.onupgradeneeded=function(t){t.target.result.createObjectStore("restaurants",{keyPath:"id"})},new Promise(function(n,e){t.onsuccess=function(t){var o=t.target.result,u=o.transaction(["restaurants"],"readwrite").objectStore("restaurants");n(new Promise(function(e,n){var r=[];u.openCursor().onsuccess=function(t){var n=t.target.result;n||r.length?n?(r.push(n.value),n.continue()):e(r):e(fetch(a.DATABASE_URL).then(function(t){if(!t.ok)throw Error("Request failed. Returned status of "+t.statusText);return t.json()}).then(function(t){var n=o.transaction(["restaurants"],"readwrite").objectStore("restaurants");return t.forEach(function(t){n.add(t)}),t}).catch(function(t){console.log(t)}))},u.openCursor().onerror=function(t){n(t.target.errorCode)}}))},t.onerror=function(t){e(t.target.errorCode)}})}return fetch(a.DATABASE_URL).then(function(t){if(!t.ok)throw Error("Request failed. Returned status of "+t.statusText);return t.json()}).then(function(t){return t}).catch(function(t){console.log(t)})}},{key:"fetchNeighborhoods",value:function(){return a.fetchRestaurants().then(function(e){var r=e.map(function(t,n){return e[n].neighborhood});return r.filter(function(t,n){return r.indexOf(t)===n})}).catch(function(t){console.log(t)})}},{key:"fetchCuisines",value:function(){return a.fetchRestaurants().then(function(e){var r=e.map(function(t,n){return e[n].cuisine_type});return r.filter(function(t,n){return r.indexOf(t)===n})}).catch(function(t){console.log(t)})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(e,r){return a.fetchRestaurants().then(function(t){var n=t;return"all"!=e&&(n=n.filter(function(t){return t.cuisine_type===e})),"all"!=r&&(n=n.filter(function(t){return t.neighborhood===r})),n}).catch(function(t){console.log(t)})}},{key:"fetchRestaurantById",value:function(e){return a.fetchRestaurants().then(function(t){var n=t.find(function(t){return t.id==e});if(!n)throw Error("Restaurant does not exist");return n}).catch(function(t){console.log(t)})}},{key:"imageUrlForRestaurant",value:function(t,n){return"/img/"+(t.photograph||"image-placeholder")+"-"+n+"w.jpg"}},{key:"formatSrcset",value:function(t){for(var n=[],e=3;e<9;e++)n.push(a.imageUrlForRestaurant(t,100*e)+" "+100*e+"w");return n.join(", ")}},{key:"urlForRestaurant",value:function(t){return"/restaurant.html?id="+t.id}},{key:"mapMarkerForRestaurant",value:function(t,n){return new google.maps.Marker({position:t.latlng,title:t.name+" "+t.neighborhood,url:a.urlForRestaurant(t),map:n,animation:google.maps.Animation.DROP})}},{key:"fetchRestaurantByCuisine",value:function(n){return a.fetchRestaurants().then(function(t){return t.filter(function(t){return t.cuisine_type==n})}).catch(function(t){console.log(t)})}},{key:"fetchRestaurantByNeighborhood",value:function(n){return a.fetchRestaurants().then(function(t){return t.filter(function(t){return t.neighborhood==n})}).catch(function(t){console.log(t)})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),a}();
//# sourceMappingURL=dbhelper.js.map
