"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(u,m,l){if(!u.fetch)throw new ClientError(400,"Fetch API Not Supported");m.gEBI=m.getElementById,m.cE=m.createElement,u.IntersectionObserver&&u.IntersectionObserverEntry&&"intersectionRatio"in u.IntersectionObserverEntry.prototype?"isIntersecting"in u.IntersectionObserverEntry.prototype||Object.defineProperty(u.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return 0<this.intersectionRatio}}):r("js/intersection-observer.js");var ClientError=function ClientError(e,t){_classCallCheck(this,ClientError),this.code=e,this.message=t},i="http://localhost:1337/restaurants",f=void 0,p=void 0,c=!1;function n(t){"loading"!==m.readyState?t():m.addEventListener("DOMContentLoaded",function e(){t(),m.removeEventListener("DOMContentLoaded",e)})}function o(){return fetch(i).then(function(e){if(!e.ok)throw Error("Request failed. Returned status of "+e.statusText);return e.json()}).then(function(e){return e}).catch(function(e){console.log(e)})}function h(e,t){return new google.maps.Marker({position:e.latlng,title:e.name+" "+e.neighborhood,url:g(e),map:t,animation:google.maps.Animation.DROP})}function g(e){return"/restaurant.html?id="+e.id}function s(e,t){return"/img/"+e.photograph+"-"+t+"w.jpg"}function r(e){var t=m.cE("script");t.src=e,t.setAttribute("async",""),m.head.appendChild(t)}function v(e){var t=setTimeout(e);u.addEventListener("resize",function(){clearTimeout(t),t=setTimeout(e,60)})}function E(){var e=f.clientWidth,t=f.clientHeight,n=640<e||640<t?2:1,r=t<e?+(e/t).toFixed(6):+(t/e).toFixed(6);return t<e?(e=640<e?640:e,t=Math.round(e/r)):(t=640<t?640:t,e=Math.round(t/r)),{width:e,height:t,scale:n}}function b(){f.style.cursor="pointer",d(f,function(e){var t;l.onLine?(r("https://maps.googleapis.com/maps/api/js?key=AIzaSyAxfOOcB40yMKfupF4qyfa4hwvhTclZboA&libraries=places&callback=initMap"),t=e,m.gEBI("map").style.display="block",f.removeAttribute("tabindex"),f.removeAttribute("role"),f.removeAttribute("aria-label"),t&&setTimeout(function(){m.querySelector('#map div[tabindex="0"]').focus()},1e3)):y("x")},!0)}function d(n,r,a){var i=function(e,t){e.preventDefault(),e.stopPropagation(),r(t),a&&(n.removeEventListener("click",i),n.removeEventListener("keydown",o))},o=function(e){13===e.keyCode&&i(e,!0)};n.addEventListener("click",i),n.addEventListener("keydown",o)}function y(e){var t=m.cE("div"),n=m.cE("p");if(t.id="offline-alert",t.setAttribute("role","alert"),n.innerHTML="âš  You are offline, map is not available.",t.appendChild(n),e){var r=m.cE("p"),a=m.cE("button");a.type="button",a.innerHTML="CLOSE",r.appendChild(a),t.appendChild(r),d(a,function(){t.remove(),f.removeAttribute("class"),b()})}f.className="offline",f.appendChild(t),f.style.cursor="default"}function w(e){e.addListener("click",function(){u.location.href=e.url})}function L(i,o){var e=new google.maps.OverlayView;if(e.draw=function(){this.getPanes().markerLayer.id="markerLayer"},e.setMap(p),c)i();else var s=p.addListener("tilesloaded",function(){var e,t,n,r,a;i(),e=o,t=m.cE("a"),n=m.cE("h2"),r=m.querySelector('#map div[tabindex="0"]'),a=m.gEBI("map"),t.className="skip-link button",t.href=e?"#filter-options":"#restaurant-container",t.innerHTML="Skip the map",f.insertBefore(t,f.firstChild),n.id="map-label",n.className="sr-only",n.innerHTML="Google Maps Widget: shows restaurants location",f.insertBefore(n,f.firstChild),r.setAttribute("aria-labelledby","map-label"),r.addEventListener("focus",function(){a.classList.add("focused")}),r.addEventListener("blur",function(){a.classList.remove("focused")}),a.addEventListener("focus",function(){p.setOptions({keyboardShortcuts:!0})},!0),a.addEventListener("blur",function(){p.setOptions({keyboardShortcuts:!1})},!0),c=!0,google.maps.event.removeListener(s)})}function M(a,i,o){setTimeout(function(){for(var e=m.querySelectorAll('[id^="gmimap"]> area'),n=m.querySelectorAll("#markerLayer img"),t=function(t){e[t].tabIndex=0,e[t].addEventListener("focus",function(){n[t].classList.add("focused")}),e[t].addEventListener("blur",function(){n[t].classList.remove("focused")}),e[t].addEventListener("keydown",function(e){13===e.keyCode&&(a=a||i[t],u.location.href=g(a))})},r=0;r<e.length;r++)t(r);o()},150)}function C(e,t,n){var r=m.cE("img");if(r.className="restaurant-img",r.alt=e.photoDescription||(n?"The "+e.cuisine_type+" Restaurant "+e.name:"The Restaurant "+e.name+" in "+e.neighborhood),r.src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="8" height="6"></svg>',e.photograph){var a=m.cE("picture"),i=m.cE("source"),o=m.cE("source");i.dataset.srcset=function(e){for(var t=[],n=3;n<9;n++)t.push(s(e,100*n)+" "+100*n+"w");return t.join(", ")}(e),o.dataset.srcset=i.dataset.srcset.replace(/w.jpg/g,"w.webp"),i.sizes="(min-width: 1366px) calc((1366px - "+(n?"5rem) / 4":"4rem) / 3")+"), (min-width: 1080px) calc((100vw - 4rem) / 3), (min-width: 700px) calc((100vw - 3rem) / 2), calc(100vw - 2rem)",o.sizes=i.sizes,r.dataset.src=s(e,800),r.classList.add("lazy"),r.onerror=function(){o.remove()},a.append(o,i,r),t.insertBefore(a,t.firstChild)}else r.src="/img/image-fallback.svg",t.insertBefore(r,t.firstChild)}function T(){var e=[].slice.call(m.querySelectorAll(".lazy"));if(e){var a=new IntersectionObserver(function(e){e.forEach(function(e){if(e.isIntersecting){var t=e.target,n=t.parentElement.children[0],r=t.parentElement.children[1];n.srcset=n.dataset.srcset,r.srcset=r.dataset.srcset,t.src=t.dataset.src,t.style.opacity=1,n.removeAttribute("data-srcset"),r.removeAttribute("data-srcset"),t.removeAttribute("data-src"),a.unobserve(t)}})});e.forEach(function(e){a.observe(e)})}}(function(){{if(u.indexedDB){var e=u.indexedDB.open("nyc_rr_data",1);return e.onupgradeneeded=function(e){var t=e.target.result;t.createObjectStore("restaurants",{keyPath:"id"})},new Promise(function(n){e.onsuccess=function(e){var a=e.target.result,t=a.transaction(["restaurants"],"readwrite").objectStore("restaurants");n(new Promise(function(n){var r=[];t.openCursor().onsuccess=function(e){var t=e.target.result;t||r.length?t?(r.push(t.value),t.continue()):n(r):n(fetch(i).then(function(e){if(!e.ok)throw Error("Request failed. Returned status of "+e.statusText);return e.json()}).then(function(e){var t=a.transaction(["restaurants"],"readwrite").objectStore("restaurants");return e.forEach(function(e){t.add(e)}),e}).catch(function(e){console.log(e)}))},t.openCursor().onerror=function(e){console.log(e.target.error),n(o())}}))},e.onerror=function(e){console.log(e.target.error),n(o())}})}return o()}})().then(function(c){"/"===u.location.pathname?function(){var r=[],a=void 0,i=void 0,d=void 0;function e(){return new Promise(function(e){var t=a[a.selectedIndex].value,n=i[i.selectedIndex].value,r=c.slice(0);"all"!=n&&(r=r.filter(function(e){return e.cuisine_type===n})),"all"!=t&&(r=r.filter(function(e){return e.neighborhood===t})),e(r)})}function o(t){t.forEach(function(e){var t=h(e,p);w(t),r.push(t)}),L(function(){M(null,t,function(){var e=1<t.length?"s":"";m.querySelector("#map iframe").title="Map shows "+t.length+" restaurant"+e})},!0)}function t(){e().then(function(e){var t,n;p&&(t=e,r.length&&(r.forEach(function(e){return e.setMap(null)}),r=[]),o(t)),n=e,d.innerHTML="",s(n),T()})}function s(e){var t=m.gEBI("results-notice");if(e.length){e.forEach(function(e){var t,n,r,a,i,o,s,c,u,l;d.appendChild((t=e,n=m.cE("li"),r=m.cE("article"),a=m.cE("h3"),i=m.cE("p"),o=m.cE("strong"),s=m.cE("address"),c=m.cE("p"),u=m.cE("p"),l=m.cE("a"),C(t,r,!0),a.innerHTML=t.name,o.innerHTML=""+t.neighborhood,i.appendChild(o),c.innerHTML=t.address,s.appendChild(c),l.innerHTML="View Details",l.href=g(t),l.className="button",l.setAttribute("aria-label","View Details about "+t.name),u.appendChild(l),r.append(a,i,s,u),n.appendChild(r),n))});var n=1<e.length?"s":"";t.innerHTML=e.length+" restaurant"+n+" found"}else t.innerHTML="No restaurants found"}n(function(){f=m.gEBI("static-map"),a=m.gEBI("neighborhoods-select"),i=m.gEBI("cuisines-select"),d=m.gEBI("restaurants-list"),l.onLine?(v(function(){var e;e=E(),f.style.backgroundImage="url(https://maps.googleapis.com/maps/api/staticmap?center=40.722216,-73.987501&zoom=12&size="+e.width+"x"+e.height+"&scale="+e.scale+"&format=jpg&key=AIzaSyAxfOOcB40yMKfupF4qyfa4hwvhTclZboA)"}),b(),function(){a.addEventListener("change",t),i.addEventListener("change",t);var n=c.map(function(e,t){return c[t].neighborhood});(n=n.filter(function(e,t){return n.indexOf(e)===t})).forEach(function(e){var t=m.cE("option");t.innerHTML=e,t.value=e,a.appendChild(t)});var r=c.map(function(e,t){return c[t].cuisine_type});(r=r.filter(function(e,t){return r.indexOf(e)===t})).forEach(function(e){var t=m.cE("option");t.innerHTML=e,t.value=e,i.appendChild(t)})}()):y(),s(c),T()}),u.initMap=function(){p=new google.maps.Map(m.gEBI("map"),{center:{lat:40.722216,lng:-73.987501},zoom:12,scrollwheel:!1,keyboardShortcuts:!1}),e().then(function(e){o(e)})}}():function(){var i=function(){var e=new URL(u.location.href).searchParams.get("id");if(e&&c[e-1])return c[e-1]}();if(!i)throw new ClientError(404,"File Not Found");n(function(){var e,t,n,r,a;f=m.gEBI("static-map"),l.onLine?(v(function(){var e;e=E(),f.style.backgroundImage="url(https://maps.googleapis.com/maps/api/staticmap?size="+e.width+"x"+e.height+"&scale="+e.scale+"&markers=color:red%7C"+i.latlng.lat+","+i.latlng.lng+"&format=jpg&key=AIzaSyAxfOOcB40yMKfupF4qyfa4hwvhTclZboA)"}),b()):y(),e=i,t=m.gEBI("breadcrumb"),n=m.cE("li"),r=m.cE("a"),a=g(e),r.href=a,r.setAttribute("aria-current","page"),r.innerHTML=e.name,n.appendChild(r),t.appendChild(n),function(e){var t=m.querySelector("#restaurant-container> div"),n=m.gEBI("restaurant-name"),r=m.gEBI("restaurant-address"),a=m.gEBI("restaurant-cuisine"),i=m.cE("strong");m.title=e.name+" - Restaurant Info and Reviews",C(e,t),n.innerHTML=e.name,r.innerHTML=e.address,i.innerHTML="Type of Cuisine: "+e.cuisine_type,a.appendChild(i),e.operating_hours&&function(e){var t=m.gEBI("restaurant-hours");for(var n in e){var r=m.cE("tr"),a=m.cE("th"),i=m.cE("td");a.innerHTML=n,a.scope="row",i.innerHTML=e[n],r.append(a,i),t.appendChild(r)}}(e.operating_hours);!function(e){var t=m.gEBI("reviews-container"),n=m.cE("h2"),v=m.gEBI("reviews-list");if(n.innerHTML="Reviews",t.appendChild(n),!e){var r=m.cE("p");return r.innerHTML="No reviews yet!",t.appendChild(r)}e.forEach(function(e){var t,n,r,a,i,o,s,c,u,l,d,f,p,h,g;v.appendChild((t=e,n=m.cE("li"),r=m.cE("article"),a=m.cE("header"),i=m.cE("h3"),o=m.cE("span"),s=m.cE("time"),c=m.cE("p"),u=m.cE("abbr"),l=m.cE("p"),o.innerHTML=t.name,s.dateTime=(d=t.date,f=new Date(d),p=f.getFullYear(),h=f.getMonth()+1+"",g=f.getDate()+"",h.length<2&&(h="0"+h),g.length<2&&(g="0"+g),[p,h,g].join("-")),s.innerHTML=t.date,i.append(o,s),a.appendChild(i),u.title="Rating: "+t.rating+" of 5",u.className="stars-"+t.rating,c.appendChild(u),l.innerHTML=t.comments,r.append(a,c,l),n.appendChild(r),n))}),t.appendChild(v)}(e.reviews)}(i),T()}),u.initMap=function(){p=new google.maps.Map(m.gEBI("map"),{center:i.latlng,zoom:17,scrollwheel:!1,keyboardShortcuts:!1}),w(h(i,p)),L(function(){M(i,null,function(){m.querySelector("#map iframe").title="Map shows "+i.name+" location"})})}}()}).catch(function(e){console.log(e)})}(window,document,navigator);
//# sourceMappingURL=app.js.map
