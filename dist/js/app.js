"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(u,h,v){if(!u.fetch)throw new ClientError(400,"Fetch API Not Supported");h.gEBI=h.getElementById,h.cE=h.createElement,u.IntersectionObserver&&u.IntersectionObserverEntry&&"intersectionRatio"in u.IntersectionObserverEntry.prototype?"isIntersecting"in u.IntersectionObserverEntry.prototype||Object.defineProperty(u.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return 0<this.intersectionRatio}}):i("js/intersection-observer.js");var ClientError=function ClientError(e,t){_classCallCheck(this,ClientError),this.code=e,this.message=t},t="http://localhost:1337/restaurants",l=void 0,d=void 0,s=void 0,f=void 0;function n(t){"loading"!==h.readyState?t():h.addEventListener("DOMContentLoaded",function e(){t(),h.removeEventListener("DOMContentLoaded",e)})}function g(o,c,s){if(u.indexedDB){var e=u.indexedDB.open("nyc_rr_data",1);return e.onupgradeneeded=function(e){var t=e.target.result;t.createObjectStore("restaurants",{keyPath:"id"}),t.createObjectStore("reviews",{keyPath:"id"}).createIndex("restaurant_id","restaurant_id",{unique:!1})},new Promise(function(n){e.onsuccess=function(e){var i=e.target.result,t=i.transaction([o],"readonly").objectStore(o),a="reviews"===o?t.index("restaurant_id"):t;n(new Promise(function(n){var r=[],e=s?IDBKeyRange.only(s):null;a.openCursor(e).onsuccess=function(e){var t=e.target.result;t||r.length?t?(r.push(t.value),v.onLine&&t.value.offline_request&&function(e,t){if(!v.serviceWorker||!u.SyncManager)return;"restaurants"===e&&v.serviceWorker.controller.postMessage({action:"favorite-sync-"+t})}(o,t.value.id),t.continue()):n(r):n(fetch(c).then(function(e){if(!e.ok)throw Error("Request failed. Returned status of "+e.statusText);return e.json()}).then(function(e){var t=i.transaction([o],"readwrite").objectStore(o);return e.forEach(function(e){t.put(e)}),e}).catch(function(e){console.log(e)}))},a.openCursor(e).onerror=function(e){console.log(e.target.error),n(p(o,c))}}))},e.onerror=function(e){console.log(e.target.error),n(p(o,c))}})}return p(o,c)}function p(e,t){return fetch(t).then(function(e){if(!e.ok)throw Error("Request failed. Returned status of "+e.statusText);return e.json()}).then(function(e){return e}).catch(function(e){console.log(e)})}function m(t){if(!v.onLine&&v.serviceWorker&&u.SyncManager&&u.indexedDB)return t.offline_request=!0,e(t),void v.serviceWorker.ready.then(function(e){return e.sync.register("favorite-sync-"+t.id)}).catch(function(e){console.log(e),r(t)});u.indexedDB&&e(t),r(t)}function r(e){fetch(t+"/"+e.id+"/?is_favorite="+e.is_favorite,{method:"PUT"}).catch(function(e){console.log(e)})}function e(r){var e=u.indexedDB.open("nyc_rr_data",1);e.onsuccess=function(e){var n=e.target.result.transaction(["restaurants"],"readwrite").objectStore("restaurants"),t=n.get(r.id);t.onsuccess=function(e){var t=e.target.result;t.is_favorite=r.is_favorite,r.offline_request&&(t.offline_request=!0),n.put(t).onerror=function(e){console.log(e.target.error)}},t.onerror=function(e){console.log(e.target.error)}},e.onerror=function(e){console.log(e.target.error)}}function E(e,t){return new google.maps.Marker({position:e.latlng,title:e.name+" "+e.neighborhood,url:b(e),map:t,animation:google.maps.Animation.DROP})}function b(e){return"/restaurant.html?id="+e.id}function c(e,t){return"/img/"+e.photograph+"-"+t+"w.jpg"}function i(e){var t=h.cE("script");t.src=e,t.setAttribute("async",""),h.head.appendChild(t)}function y(e){var t=setTimeout(e);u.addEventListener("resize",function(){clearTimeout(t),t=setTimeout(e,60)})}function L(){var e=l.clientWidth,t=l.clientHeight,n=640<e||640<t?2:1,r=t<e?+(e/t).toFixed(6):+(t/e).toFixed(6);return t<e?(e=640<e?640:e,t=Math.round(e/r)):(t=640<t?640:t,e=Math.round(t/r)),{width:e,height:t,scale:n}}function w(e){fetch(e).then(function(e){return e.blob()}).then(function(e){l.style.backgroundImage="url("+URL.createObjectURL(e)+")",l.style.opacity=1}).catch(function(e){console.log(e)})}function I(){l.style.cursor="pointer",a(l,function(){k()},!0)}function a(t,n,r){var i=function(e){e.preventDefault(),e.stopPropagation(),n(),r&&(t.removeEventListener("click",i),t.removeEventListener("keydown",a))},a=function(e){13===e.keyCode&&i(e,!0)};t.addEventListener("click",i),t.addEventListener("keydown",a)}function k(){v.onLine?(i("https://maps.googleapis.com/maps/api/js?key=AIzaSyAxfOOcB40yMKfupF4qyfa4hwvhTclZboA&libraries=places&callback=initMap"),h.gEBI("map").style.display="block",l.removeAttribute("tabindex"),l.removeAttribute("role"),l.removeAttribute("aria-label")):M("x")}function M(e){var t=h.cE("div"),n=h.cE("p");if(t.id="offline-alert",t.setAttribute("role","alert"),n.innerHTML="âš  You are offline, map is not available.",t.appendChild(n),e){var r=h.cE("p"),i=h.cE("button");i.type="button",i.innerHTML="CLOSE",r.appendChild(i),t.appendChild(r),a(i,function(){t.remove(),l.removeAttribute("class"),I()})}l.className="offline",l.style.opacity=1,l.appendChild(t),l.style.cursor="default"}function x(e){e.addListener("click",function(){u.location.href=e.url})}function C(a,o){var e=new google.maps.OverlayView;if(e.draw=function(){this.getPanes().markerLayer.id="markerLayer"},e.setMap(d),s)a();else var c=d.addListener("tilesloaded",function(){var e,t,n,r,i;a(),e=o,t=h.cE("a"),n=h.cE("h2"),r=h.querySelector('#map div[tabindex="0"]'),i=h.gEBI("map"),t.className="skip-link button",t.href=e?"#filter-options":"#restaurant-container",t.innerHTML="Skip the map",l.insertBefore(t,l.firstChild),n.id="map-label",n.className="sr-only",n.innerHTML="Google Maps Widget: shows restaurants location",l.insertBefore(n,l.firstChild),r.setAttribute("aria-labelledby","map-label"),r.addEventListener("focus",function(){i.classList.add("focused")}),r.addEventListener("blur",function(){i.classList.remove("focused")}),i.addEventListener("focus",function(){d.setOptions({keyboardShortcuts:!0})},!0),i.addEventListener("blur",function(){d.setOptions({keyboardShortcuts:!1})},!0),s=!0,f||h.querySelector('#map div[tabindex="0"]').focus(),google.maps.event.removeListener(c)})}function T(i,a,o){setTimeout(function(){for(var e=h.querySelectorAll('[id^="gmimap"]> area'),n=h.querySelectorAll("#markerLayer img"),t=function(t){e[t].tabIndex=0,e[t].addEventListener("focus",function(){n[t].classList.add("focused")}),e[t].addEventListener("blur",function(){n[t].classList.remove("focused")}),e[t].addEventListener("keydown",function(e){13===e.keyCode&&(i=i||a[t],u.location.href=b(i))})},r=0;r<e.length;r++)t(r);o()},150)}function B(e,t,n){var r=h.cE("img");if(r.className="restaurant-img",r.alt=e.photoDescription||(n?"The "+e.cuisine_type+" Restaurant "+e.name:"The Restaurant "+e.name+" in "+e.neighborhood),r.src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="8" height="6"></svg>',e.photograph){var i=h.cE("picture"),a=h.cE("source"),o=h.cE("source");a.dataset.srcset=function(e){for(var t=[],n=3;n<9;n++)t.push(c(e,100*n)+" "+100*n+"w");return t.join(", ")}(e),o.dataset.srcset=a.dataset.srcset.replace(/w.jpg/g,"w.webp"),a.sizes="(min-width: 1366px) calc((1366px - "+(n?"5rem) / 4":"4rem) / 3")+"), (min-width: 1080px) calc((100vw - 4rem) / 3), (min-width: 700px) calc((100vw - 3rem) / 2), calc(100vw - 2rem)",o.sizes=a.sizes,r.dataset.src=c(e,800),r.classList.add("lazy"),r.onerror=function(){o.remove()},i.append(o,a,r),t.insertBefore(i,t.firstChild)}else r.src="/img/image-fallback.svg",t.insertBefore(r,t.firstChild)}function A(){var e=[].slice.call(h.querySelectorAll(".lazy"));if(e){var i=new IntersectionObserver(function(e){e.forEach(function(e){if(e.isIntersecting){var t=e.target,n=t.parentElement.children[0],r=t.parentElement.children[1];n.srcset=n.dataset.srcset,r.srcset=r.dataset.srcset,t.src=t.dataset.src,t.style.opacity=1,n.removeAttribute("data-srcset"),r.removeAttribute("data-srcset"),t.removeAttribute("data-src"),i.unobserve(t)}})});e.forEach(function(e){i.observe(e)})}}g("restaurants",t).then(function(s){"/"===u.location.pathname||"/index.html"===u.location.pathname?function(){var r=[],i=void 0,a=void 0,p=void 0;function e(){return new Promise(function(e){var t=i[i.selectedIndex].value,n=a[a.selectedIndex].value,r=s.slice(0);"all"!=n&&(r=r.filter(function(e){return e.cuisine_type===n})),"all"!=t&&(r=r.filter(function(e){return e.neighborhood===t})),e(r)})}function o(t){t.forEach(function(e){var t=E(e,d);x(t),r.push(t)}),C(function(){T(null,t,function(){var e=1<t.length?"s":"";h.querySelector("#map iframe").title="Map shows "+t.length+" restaurant"+e})},!0)}function t(){e().then(function(e){var t,n;d&&(t=e,r.length&&(r.forEach(function(e){return e.setMap(null)}),r=[]),o(t)),n=e,p.innerHTML="",c(n),A()}),l&&!d&&(f=!0,k())}function c(e){var t=h.gEBI("results-notice");if(e.length){e.forEach(function(e){var t,n,r,i,a,o,c,s,u,l,d,f;p.appendChild((t=e,n=h.cE("li"),r=h.cE("article"),i=h.cE("h3"),a=h.cE("p"),o=h.cE("strong"),c=h.cE("address"),s=h.cE("p"),u=h.cE("p"),l=h.cE("label"),d=h.cE("input"),f=h.cE("a"),B(t,r,!0),i.innerHTML=t.name,o.innerHTML=""+t.neighborhood,a.appendChild(o),s.innerHTML=t.address,c.appendChild(s),d.type="checkbox",d.id="favorite-"+t.id,d.checked="false"!==t.is_favorite&&("true"===t.is_favorite||t.is_favorite),d.className="button",d.addEventListener("click",function(){m({id:t.id,is_favorite:d.checked})}),l.htmlFor=d.id,l.className="sr-only",l.innerHTML="Is "+t.name+" your favorite restaurant?",f.innerHTML="View Details",f.href=b(t),f.className="button",f.setAttribute("aria-label","View Details about "+t.name),u.append(l,d,f),r.append(i,a,c,u),n.appendChild(r),n))});var n=1<e.length?"s":"";t.innerHTML=e.length+" restaurant"+n+" found"}else t.innerHTML="No restaurants found"}n(function(){l=h.gEBI("static-map"),i=h.gEBI("neighborhoods-select"),a=h.gEBI("cuisines-select"),p=h.gEBI("restaurants-list"),v.onLine?(y(function(){var e;w("https://maps.googleapis.com/maps/api/staticmap?center=40.722216,-73.987501&zoom=12&size="+(e=L()).width+"x"+e.height+"&scale="+e.scale+"&format=jpg&key=AIzaSyAxfOOcB40yMKfupF4qyfa4hwvhTclZboA")}),I()):M(),function(){i.addEventListener("change",t),a.addEventListener("change",t);var n=s.map(function(e,t){return s[t].neighborhood});(n=n.filter(function(e,t){return n.indexOf(e)===t})).forEach(function(e){var t=h.cE("option");t.innerHTML=e,t.value=e,i.appendChild(t)});var r=s.map(function(e,t){return s[t].cuisine_type});(r=r.filter(function(e,t){return r.indexOf(e)===t})).forEach(function(e){var t=h.cE("option");t.innerHTML=e,t.value=e,a.appendChild(t)})}(),c(s),A()}),u.initMap=function(){d=new google.maps.Map(h.gEBI("map"),{center:{lat:40.722216,lng:-73.987501},zoom:12,scrollwheel:!1,keyboardShortcuts:!1}),e().then(function(e){o(e)})}}():function(){var a=function(){var e=new URL(u.location.href).searchParams.get("id");if(e&&s[e-1])return s[e-1]}();if(!a)throw new ClientError(404,"File Not Found");n(function(){var e,t,n,r,i;l=h.gEBI("static-map"),v.onLine?(y(function(){var e;w("https://maps.googleapis.com/maps/api/staticmap?size="+(e=L()).width+"x"+e.height+"&scale="+e.scale+"&markers=color:red%7C"+a.latlng.lat+","+a.latlng.lng+"&format=jpg&key=AIzaSyAxfOOcB40yMKfupF4qyfa4hwvhTclZboA")}),I()):M(),e=a,t=h.gEBI("breadcrumb"),n=h.cE("li"),r=h.cE("a"),i=b(e),r.href=i,r.setAttribute("aria-current","page"),r.innerHTML=e.name,n.appendChild(r),t.appendChild(n),function(e){var t=h.querySelector("#restaurant-container> div"),n=h.gEBI("restaurant-name"),r=h.gEBI("restaurant-address"),i=h.gEBI("restaurant-cuisine"),a=h.cE("strong"),o=h.gEBI("favorite"),c=h.gEBI("add-review-button"),s=h.gEBI("overlay"),u=h.querySelector("#overlay form"),l=h.gEBI("username"),d=h.gEBI("close-overlay-button"),f=h.gEBI("page"),p=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed","[contenteditable]"].join(",");h.title=e.name+" - Restaurant Info and Reviews",B(e,t),n.innerHTML=e.name,r.innerHTML=e.address,a.innerHTML="Type of Cuisine: "+e.cuisine_type,i.appendChild(a),e.operating_hours&&function(e){var t=h.gEBI("restaurant-hours");for(var n in e){var r=h.cE("tr"),i=h.cE("th"),a=h.cE("td");i.innerHTML=n,i.scope="row",a.innerHTML=e[n],r.append(i,a),t.appendChild(r)}}(e.operating_hours);o.checked="false"!==e.is_favorite&&("true"===e.is_favorite||e.is_favorite),o.addEventListener("click",function(){m({id:e.id,is_favorite:o.checked})}),c.addEventListener("click",function(){var e=[].slice.call(f.querySelectorAll(p)),t=[].slice.call(f.querySelectorAll('[tabindex="0"]')),n=[].slice.call(s.querySelectorAll('[tabindex="-1"]'));function r(e){27===e.keyCode&&(e.preventDefault(),e.stopPropagation(),i(),d.removeEventListener("click",i))}function i(){e.forEach(function(e){e.removeAttribute("tabindex")}),t.forEach(function(e){e.tabIndex=0}),n.forEach(function(e){e.tabIndex=-1}),f.removeAttribute("aria-hidden"),s.classList.remove("opened"),s.setAttribute("aria-hidden",!0),c.focus(),h.removeEventListener("keydown",r)}e.forEach(function(e){e.tabIndex=-1}),t.forEach(function(e){e.tabIndex=-1}),n.forEach(function(e){e.tabIndex=0}),s.removeAttribute("aria-hidden"),s.classList.add("opened"),f.setAttribute("aria-hidden",!0),l.focus(),d.addEventListener("click",i),h.addEventListener("keydown",r),u.addEventListener("submit",function(e){e.preventDefault(),e.stopPropagation()})}),g("reviews","http://localhost:1337/reviews/?restaurant_id="+e.id,e.id).then(function(e){!function(e){var t=h.gEBI("reviews-container"),n=h.cE("h2"),f=h.gEBI("reviews-list");if(n.innerHTML="Reviews",t.appendChild(n),!e){var r=h.cE("p");return r.innerHTML=v.online?"No reviews yet!":"Sorry, reviews for this restaurant are not available offline.",t.appendChild(r)}e.reverse().forEach(function(e){var t,n,r,i,a,o,c,s,u,l,d;f.appendChild((t=e,n=h.cE("li"),r=h.cE("article"),i=h.cE("header"),a=h.cE("h3"),o=h.cE("span"),c=h.cE("time"),s=h.cE("p"),u=h.cE("abbr"),l=h.cE("p"),d=new Date(t.updatedAt),o.innerHTML=t.name,c.dateTime=d.toISOString(),c.innerHTML=d.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),a.append(o,c),i.appendChild(a),u.title="Rating: "+t.rating+" of 5",u.className="stars-"+t.rating,s.appendChild(u),l.innerHTML=t.comments,r.append(i,s,l),n.appendChild(r),n))}),t.appendChild(f)}(e)}).catch(function(e){console.log(e)})}(a),A()}),u.initMap=function(){d=new google.maps.Map(h.gEBI("map"),{center:a.latlng,zoom:17,scrollwheel:!1,keyboardShortcuts:!1}),x(E(a,d)),C(function(){T(a,null,function(){h.querySelector("#map iframe").title="Map shows "+a.name+" location"})})}}()}).catch(function(e){console.log(e)})}(window,document,navigator);
//# sourceMappingURL=app.js.map
