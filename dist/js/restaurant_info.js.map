{"version":3,"sources":["js/restaurant_info.js"],"names":["w","d","n","fetch","map","initMap","onLine","fetchRestaurantFromURL","then","restaurant","listenerTiles","google","maps","Map","getElementById","center","latlng","zoom","keyboardShortcuts","addListener","mapContainer","skipMap","createElement","innerHTML","insertAdjacentElement","mapLabel","className","div","querySelector","mapDOMElement","addEventListener","classList","add","remove","setOptions","event","removeListener","DBHelper","mapMarkerForRestaurant","initMapAccessibility","title","name","fillBreadcrumb","catch","log","error","initPage","mapOfflineAlert","setAttribute","append","fillError404HTML","console","body","removeChild","main","removeAttribute","header","h1","p","aContainer","a","href","get","id","URL","location","searchParams","fetchRestaurantById","fillRestaurantHTML","address","image","src","imageUrlForRestaurant","sizes","srcset","alt","photoDescription","cuisine","neighborhood","strong","appendChild","cuisine_type","operating_hours","operatingHours","row","key","day","scope","time","hours","fillRestaurantHoursHTML","container","noReviews","reviews","ul","createReviewHTML","forEach","review","li","heading","date","getFullYear","month","getMonth","year","length","join","article","ratingContainer","rating","comments","fillReviewsHTML","url","urlForRestaurant","breadcrumb","window","document","navigator"],"mappings":"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","file":"restaurant_info.js","sourcesContent":["((w, d, n) => {\n  'use strict';\n\n  if (!w.fetch) {\n    console.log('Fetch API not supported');\n    return;\n  }\n\n  let map;\n\n  /**\n   * Initialize Google map, called from HTML with proper error handling.\n   */\n  w.initMap = () => {\n    if (!n.onLine) { // Check if offline.\n      return; // Exit from function.\n    }\n    fetchRestaurantFromURL()\n      .then(restaurant => {\n        if (!restaurant) {\n          fillError404HTML();\n          return; // Exit from function.\n        }\n        map = new google.maps.Map(d.getElementById('map'), {\n          center: restaurant.latlng,\n          zoom: 16,\n          scrollwheel: false,\n          keyboardShortcuts: false // Disable Google Maps keyboard UI.\n        });\n        DBHelper.mapMarkerForRestaurant(restaurant, map);\n        initMapAccessibility();\n        const listenerTiles = map.addListener('tilesloaded', () => {\n          setTimeout(() => {\n            /* Relying on the title attribute is currently discouraged as many user agents do not expose the attribute in an accessible manner as required by w3c specifications. https://www.w3.org/TR/html/dom.html#the-title-attribute */\n            /* However, many sources say that <iframe> elements in the document must have a title that is not empty to describe their contents to screen reader users. https://dequeuniversity.com/rules/axe/2.2/frame-title */\n            d.querySelector('#map iframe').title = `Map shows ${restaurant.name} location`;\n          }, 150);\n          // Remove event listener.\n          google.maps.event.removeListener(listenerTiles);\n        });\n        fillBreadcrumb(restaurant);\n      })\n      .catch(error => {\n        console.log(error);\n      });\n  };\n\n  /**\n   * Fetch the page content when offline, as soon as the page is loaded.\n   */\n  if (!n.onLine) { // Check if offline.\n    d.addEventListener('DOMContentLoaded', () => {\n      initPage();\n    });\n  }\n\n  /**\n   * Initialize the page whithout initialize Google Maps.\n   */\n  function initPage() {\n    fetchRestaurantFromURL()\n      .then(restaurant => {\n        if (!restaurant) {\n          fillError404HTML();\n          return; // Exit from function.\n        }\n        fillBreadcrumb(restaurant);\n        fillMapOfflineAlert();\n      })\n      .catch(error => {\n        console.log(error);\n      });\n  }\n\n  function fillError404HTML() {\n    // Prepare restaurant.html to receive new html codes.\n    d.querySelector('title').innerHTML = 'Page Not Found - Restaurant Reviews';\n    d.body.removeChild(d.querySelector('a.skip-link'));\n    d.body.removeChild(d.querySelector('nav[aria-label=\"Breadcrumb\"]'));\n    const main = d.querySelector('main');\n    main.innerHTML = '';\n    d.body.className = 'error-page';\n    main.removeAttribute('class');\n\n    // Create new elements to build a 404 page.\n    const div = d.createElement('div');\n    div.setAttribute('role', 'alert');\n    const header = d.createElement('header');\n    const h1 = d.createElement('h1');\n    h1.innerHTML = 'Error 404';\n    const p = d.createElement('p');\n    p.innerHTML = 'Sorry, but the page you were trying to view does not exist.';\n    header.append(h1);\n    header.append(p);\n\n    const aContainer = d.createElement('p');\n    const a = d.createElement('a');\n    a.href = '/';\n    a.className = 'button';\n    a.innerHTML = 'Go to our home page';\n    aContainer.append(a);\n\n    div.append(header);\n    div.append(aContainer);\n    main.append(div);\n  }\n\n  /**\n   * Set map offline alert.\n   */\n  function fillMapOfflineAlert() {\n    const mapDOMElement = d.getElementById('map');\n    const mapOfflineAlert = d.createElement('p');\n    mapOfflineAlert.innerHTML = 'âš  You are offline, map is not available.';\n    mapDOMElement.classList.add('offline');\n    mapDOMElement.setAttribute('role', 'alert');\n    mapDOMElement.append(mapOfflineAlert);\n  }\n\n  /**\n   * Get current restaurant from page URL with proper error handling.\n   */\n  function fetchRestaurantFromURL() {\n    const id = getParameterByName('id');\n    if (!id) {\n      return; // No id found in URL.\n    }\n    return DBHelper.fetchRestaurantById(id)\n      .then(restaurant => {\n        if (restaurant) {\n          fillRestaurantHTML(restaurant);\n          return restaurant;\n        }\n      })\n      .catch(error => {\n        console.log(error);\n      });\n  }\n\n  /**\n   * Get a parameter by name from page URL.\n   */\n  function getParameterByName(name) {\n    const url = new URL(w.location.href);\n    return url.searchParams.get(name);\n  }\n\n  /**\n   * Create restaurant HTML and add it to the webpage.\n   */\n  function fillRestaurantHTML(restaurant) {\n    // Add a more meaningful title to the page for better accessibility.\n    const title = d.querySelector('title');\n    title.innerHTML = `${restaurant.name} - Restaurant Info and Reviews`;\n\n    const name = d.getElementById('restaurant-name');\n    name.innerHTML = restaurant.name;\n\n    const address = d.getElementById('restaurant-address');\n    address.innerHTML = restaurant.address;\n\n    const image = d.getElementById('restaurant-img');\n    image.className = 'restaurant-img';\n    image.src = DBHelper.imageUrlForRestaurant(restaurant, 800);\n    image.sizes = '(min-width: 1366px) calc((1366px - 4rem) / 3), (min-width: 1080px) calc((100vw - 4rem) / 3), (min-width: 700px) calc((100vw - 3rem) / 2), calc(100vw - 2rem)';\n    image.srcset = DBHelper.formatSrcset(restaurant);\n    /* Adding alternative text for images is the first principle of web accessibility. [...] Every image must have an alt attribute. This is a requirement of HTML standard (with perhaps a few exceptions in HTML5). Images without an alt attribute are likely inaccessible. In some cases, images may be given an empty or null alt attribute (e.g., alt=\"\"). https://webaim.org/techniques/alttext/ */\n    image.alt = restaurant.photoDescription || `The Restaurant ${restaurant.name} in ${restaurant.neighborhood}`;\n\n    const cuisine = d.getElementById('restaurant-cuisine');\n    const strong = d.createElement('strong');\n    strong.innerHTML = `Type of Cuisine: ${restaurant.cuisine_type}`;\n    cuisine.appendChild(strong);\n\n    // Fill operating hours.\n    if (restaurant.operating_hours) {\n      fillRestaurantHoursHTML(restaurant.operating_hours);\n    }\n    // Fill reviews.\n    fillReviewsHTML(restaurant.reviews);\n  }\n\n  /**\n   * Create restaurant operating hours HTML table and add it to the webpage.\n   */\n  function fillRestaurantHoursHTML(operatingHours) {\n    const hours = d.getElementById('restaurant-hours');\n    for (let key in operatingHours) {\n      const row = d.createElement('tr');\n\n      const day = d.createElement('th');\n      day.innerHTML = key;\n      day.scope = 'row';\n      row.appendChild(day);\n\n      const time = d.createElement('td');\n      time.innerHTML = operatingHours[key];\n      row.appendChild(time);\n\n      hours.appendChild(row);\n    }\n  }\n\n  /**\n   * Create all reviews HTML and add them to the webpage.\n   */\n  function fillReviewsHTML(reviews) {\n    const container = d.getElementById('reviews-container');\n    const title = d.createElement('h2');\n    title.innerHTML = 'Reviews';\n    container.appendChild(title);\n\n    if (!reviews) {\n      const noReviews = d.createElement('p');\n      noReviews.innerHTML = 'No reviews yet!';\n      container.appendChild(noReviews);\n      return;\n    }\n    const ul = d.getElementById('reviews-list');\n    reviews.forEach(review => {\n      ul.appendChild(createReviewHTML(review));\n    });\n    container.appendChild(ul);\n  }\n\n  /**\n   * Create review HTML and add it to the webpage.\n   */\n  function createReviewHTML(review) {\n    const li = d.createElement('li');\n    const article = d.createElement('article');\n\n    const header = d.createElement('header');\n    const heading = d.createElement('h3');\n\n    const name = d.createElement('span');\n    name.innerHTML = review.name;\n    heading.appendChild(name);\n\n    const date = d.createElement('time');\n    date.dateTime = formatDatetime(review.date);\n    date.innerHTML = review.date;\n    heading.appendChild(date);\n\n    header.appendChild(heading);\n    article.appendChild(header);\n\n    const ratingContainer = d.createElement('p');\n    /* Ratings are often presented either as a set of images or characters, e.g. \"***\". For these, the <abbr> element is particularly useful, as such characters are an abbreviation for the precise rating, e.g. <abbr class=\"rating\" title=\"3.0\">***</abbr>. http://microformats.org/wiki/hreview */\n    const rating = d.createElement('abbr');\n    /* Relying on the title attribute is currently discouraged as many user agents do not expose the attribute in an accessible manner as required by w3c specifications. https://www.w3.org/TR/html/dom.html#the-title-attribute */\n    /* The only very tiny exception a title attribute will be read by a screen reader is if there's absolutely no link anchor text. https://silktide.com/i-thought-title-text-improved-accessibility-i-was-wrong/ */\n    /* The title is an HTML global attribute, so it can be used on any HTML element. The screen readers behaviour is the same for all elements with the title attribute. For these reasons, in this case, the inner text node was left blank. The stars are rendered using ::before and ::after pseudo elements. --> */\n    rating.title = `Rating: ${review.rating} of 5`;\n    rating.className = `stars-${review.rating}`;\n    ratingContainer.appendChild(rating);\n    article.appendChild(ratingContainer);\n\n    const comments = d.createElement('p');\n    comments.innerHTML = review.comments;\n    article.appendChild(comments);\n\n    li.appendChild(article);\n    return li;\n  }\n\n  /**\n   * Get a representation of date string in a machine-readable format.\n   */\n  function formatDatetime(date) {\n    const d = new Date(date),\n      year = d.getFullYear();\n    let month = (d.getMonth() + 1) + '',\n      day = d.getDate() + '';\n    if (month.length < 2) month = '0' + month;\n    if (day.length < 2) day = '0' + day;\n    return [year, month, day].join('-');\n  }\n\n  /**\n   * Fix some accessibility issue with Google map.\n   */\n  function initMapAccessibility() {\n    // This event fires when the visible tiles have finished loading.\n    const listenerTiles = map.addListener('tilesloaded', () => {\n      const mapContainer = d.getElementById('map-container');\n\n      // Add a skip map link.\n      const skipMap = d.createElement('a');\n      skipMap.className = 'skip-link button';\n      skipMap.href = '#restaurant-container';\n      skipMap.innerHTML = 'Skip the map';\n      mapContainer.insertAdjacentElement('afterbegin', skipMap);\n\n      // Add a map label.\n      const mapLabel = d.createElement('h2');\n      mapLabel.id = 'map-label';\n      mapLabel.className = 'sr-only';\n      mapLabel.innerHTML = 'Google Maps Widget: shows the restaurant location';\n      mapContainer.insertAdjacentElement('afterbegin', mapLabel);\n\n      // Add aria-lebelledBy to the div focusable with tab.\n      const div = d.querySelector('#map div[tabindex=\"0\"]');\n      div.setAttribute('aria-labelledby', 'map-label');\n\n      const mapDOMElement = d.getElementById('map');\n\n      // Highlight when map DOM element is onfocus.\n      div.addEventListener('focus', () => {\n        mapDOMElement.classList.add('focused');\n      });\n\n      // Remove highlight when map DOM element is onblur.\n      div.addEventListener('blur', () => {\n        mapDOMElement.classList.remove('focused');\n      });\n\n      /* Enable Google Maps keyboard UI, when map DOM element or any of his children is onfocus. */\n      mapDOMElement.addEventListener('focus', () => {\n        map.setOptions({keyboardShortcuts: true});\n      }, true);\n\n      /* Disable Google Maps keyboard UI, when map DOM element or any of his children is onblur. */\n      mapDOMElement.addEventListener('blur', () => {\n        map.setOptions({keyboardShortcuts: false});\n      }, true);\n\n      // Remove event listener.\n      google.maps.event.removeListener(listenerTiles);\n    });\n  }\n\n  /**\n   * Add restaurant name to the breadcrumb navigation menu\n   */\n  function fillBreadcrumb(restaurant) {\n    const breadcrumb = d.getElementById('breadcrumb');\n    const li = d.createElement('li');\n    const a = d.createElement('a');\n    const url = DBHelper.urlForRestaurant(restaurant);\n    a.href = url;\n\n    /* Here the title attribute is to avoid, and the link text is enough for accessibility. See above about title. */\n    a.setAttribute('aria-current', 'page' );\n    a.innerHTML = restaurant.name;\n    li.appendChild(a);\n    breadcrumb.appendChild(li);\n  }\n\n})(window, document, navigator);"]}